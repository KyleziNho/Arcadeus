<!DOCTYPE html>
<html>
<head>
    <title>Test Enhanced Formatting</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-container {
            border: 1px solid #ccc;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .before {
            background: #fef2f2;
            border-left: 4px solid #dc2626;
        }
        .after {
            background: #f0fdf4;
            border-left: 4px solid #16a34a;
        }
        h2 {
            margin-top: 0;
        }
    </style>
</head>
<body>
    <h1>Enhanced Chat Formatting Test</h1>
    
    <div class="test-container before">
        <h2>BEFORE (Ugly Response)</h2>
        <div id="uglyMessage">
            The high Multiple on Invested Capital (MOIC) of approximately **6.93** indicates that for every dollar invested in equity contributions, the return is nearly seven times that amount. To understand why the MOIC is so high, we can analyze the underlying components based on the data provided: 1. **Equity Contributions**: - The total equity contribution is **$57,468,400** (see FCF!B18). This figure represents the amount of capital that has been injected into the investment or project. 2. **Calculation of MOIC**: - The formula for MOIC is given by: \[ \text{MOIC} = \frac{\text{Total Distributions}}{\text{Total Equity Contributions}} \] - In the Excel sheet, the MOIC is calculated as **6.93** (FCF!B23), meaning that the total distributions (cash flows returned to investors) are significantly higher than the equity contributions.
        </div>
    </div>

    <div class="test-container after">
        <h2>AFTER (Enhanced Formatting)</h2>
        <div id="formattedMessage" class="message-text formatted-response">
            <!-- Will be populated by JavaScript -->
        </div>
    </div>

    <button onclick="testFormatting()" style="padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 6px; font-size: 16px;">
        Test Formatting
    </button>

    <!-- Include the formatter -->
    <script src="widgets/enhanced-formatting-injector.js"></script>

    <script>
        function testFormatting() {
            console.log('ðŸ§ª Testing formatting...');
            
            const uglyText = document.getElementById('uglyMessage').textContent;
            const formattedContainer = document.getElementById('formattedMessage');
            
            // Create formatter instance
            const formatter = new DirectChatFormatter();
            formatter.injectCSS();
            
            // Apply formatting
            const formatted = formatter.enhanceResponseFormatting(uglyText);
            
            console.log('Original length:', uglyText.length);
            console.log('Formatted length:', formatted.length);
            console.log('Formatted HTML:', formatted);
            
            // Display result
            formattedContainer.innerHTML = formatted;
            
            console.log('âœ… Formatting test complete!');
        }

        // Auto-run test when page loads
        setTimeout(testFormatting, 500);
    </script>
</body>
</html>